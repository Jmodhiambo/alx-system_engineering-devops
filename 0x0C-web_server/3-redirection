#!/usr/bin/env bash
# This script installs Nginx, configures a 301 redirection, and updates the default Nginx page to display "Hello World!"

# Update the package list
sudo apt update -y

# Install Nginx
sudo apt install nginx -y

# Ensure Nginx is started (without using systemctl)
sudo service nginx start

sudo chown -R ubuntu /var/www
# Replace the default Nginx page with "Hello World!"
echo "Hello World!" | sudo tee /var/www/html/index.html > /dev/null

# Configure the redirection in the Nginx configuration file
REDIRECT_URL="https://www.youtube.com/watch?v=QH2-TGUlwu4"
CONFIG_FILE="/etc/nginx/sites-available/default"

# Add redirection rule using sed
sudo sed -i "/server_name _;/a \\    location /redirect_me/ { return 301 ${REDIRECT_URL}; }" "$CONFIG_FILE"

# Restart Nginx to apply changes (without using systemctl)
sudo service nginx restart
